
@{
    ViewBag.Title = "Project Closing";
  //  Layout = "~/Views/Shared/_Layout.cshtml";
 Layout = "~/Views/Shared/_LayoutWithMenu.cshtml";

    var data = Request.QueryString["data"];
    var GetDataForTeamCalendarUrl = Url.Content("~/ProjectArchiving/GetDataLoading");

}
<script src="~/Scripts/jquery.min.js"></script>

<link href="~/Content/style/tablestyle.css" rel="stylesheet" />

<link href="~/Content/style/jquery.dataTables.min.css" rel="stylesheet" />

<script src="~/Scripts/jquery.dataTables.min.js"></script>

<script src="~/Scripts/bootstrap.js"></script>

<script src="~/Scripts/bootstrap.js"></script>
<input type="hidden" value="@ViewBag.PageSize" name="pageSize" id="pageSize" />
<input type="hidden" value="@data" name="data" />
<input type="hidden" id="loginPageUrl" value="@ViewBag.LoginPageUrl" />
<input type="hidden" id="GetDataForTeamCalendar" value="@GetDataForTeamCalendarUrl" />

<form id="frm-example" name="frm-example" method="post">

    <p class="form-group" style="margin-left:2.3%">

        <br />
    <p></p>

    <h3 class="formatH2"> Live Projects</h3>

    <div class="container">

        <div class="row">
            <div class="col">
                <table>
                    <tr style="background-color: white">
                        <td>  <input type="text" class="form-control" id="searchFilter" placeholder="search" name="email" style="width:300px;margin-left:300px;margin-bottom:50px;"></td>

                        <Td> @Html.DropDownList("projectchoose", new SelectList(ViewBag.ProjectChooseList, "Value", "Text", ""), new { @class = "form-control", @style = "margin-bottom:50px;" })</Td>
                    </tr>
                </table>
            </div>
            <div class="col">

            </div>
        </div>

    </div>


    @*<div class="hr-authorisation__status-select" style="margin-left:2%">@Html.DropDownList("projectchoose", new SelectList(ViewBag.ProjectChooseList, "Value", "Text", -1), new { @class = "form-control input-sm", @style = "margin-left:2.3%" })</div>*@


    @*<tr>*@

    </br>

    <button type="submit" @*class="btn btn-primary"*@ class="btn btn-primary right" style="margin-top:-40px;">Close Project</button>
    <td height="100%" style="vertical-align:top">
        <table width="100%">
            @*<tr style="background-color: white">
                    <td style="margin-left:93%"> <button type="submit" class="btn btn-primary" style="position:relative; margin-left:93%; margin-top:-40px;"><b style="margin-right:0px">Close Project</b></button></td>
                </tr>*@
        </table>
        <table width="100%" border="0" cellspacing="0" cellpadding="0" style="height:600px">


            <tr>
                <td bgcolor="#FFFFFF" valign="top">
                    <table class="tablesorter" id="tblProjectArchiving" width="100%">

                        <thead>
                            <tr>
                                <th style="width:10%; text-align:left">
                                    @Html.Label("APK", new { @style = "margin-right: 100px;" })
                                </th>
                                <th style="width:30%; text-align:left">@Html.Label("Project Name", new { @style = "margin-right: 200px;" })</th>
                                <th style="width:25%; text-align:left">@Html.Label("Manager", new { @style = "margin-right: 100px;" })</th>
                                <th style="width:10%; text-align:left">@Html.Label("Status")</th>
                                <th style="width:20%; text-align:left">@Html.Label("Server", new { @style = "margin-right: 200px;" })</th>
                                <th style="width:5%"><label></label></th>
                            </tr>
                        </thead>
                        <tbody style="font-family:Arial,Verdana;font-size:9pt">
                        </tbody>
                    </table>
                </td>
            </tr>
        </table>
    </td>
    @*</tr>*@
</form>
<div class="modal fade" id="type" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content" style="width:900px;height:500px;">
            <div class="modal-header">
                <h4 class="modal-title" id="defaultModalLabel">Please select the APKs that their project folder should be archived.</h4>
            </div>
            <div class="modal-body table-placeholder">

            </div>
            <div class="modal-footer" style="margin-top:2px!important">
                <button type="button" data-dismiss="modal" class="btn btn-primary" id="btnOk" disabled>Submit</button>
                <button type="button" data-dismiss="modal" class="btn" id="btnCancelData">Cancel</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="typeMessage" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-body table-placeholder-Message">
                <h4 class="modal-title" id="defaultModalLabel">Please choose one APK to process!</h4>
            </div>
            <div class="modal-footer">
                <button type="button" data-dismiss="modal" class="btn" id="btnCancel">Cancel</button>
            </div>
        </div>
    </div>
</div>

<style>
    .right {
        float: right;
        width: 100px;
        border: 1px solid #617DC0;
        margin-right: 2px;
    }

    .dataTables_filter input {
        height: 30px;
        width: 200px;
        /*border: 2px solid;*/
        border: 1px solid #ccc;
        border-radius: 4px;
    }

    .alignLeft {
        text-align: left;
        padding-left: 5px;
    }

    .alignCenter {
        text-align: center;
    }

    .dataTables_filter {
        display: none;
    }

        .dataTables_filter input {
            height: 30px;
            width: 200px;
            /*   border: 2px solid;*/
            border: 1px solid #ccc;
            border-radius: 4px;
            margin-top: 20px;
            text-align: left !important;
        }

    .searchbox {
        clear: both;
        margin-left: 300px !important;
        display: block;
        width: 20%;
        height: 34px;
        padding: 6px 12px;
        font-size: 14px;
        line-height: 1.42857143;
        color: #555;
        /*      background-color: #fff;*/
        background-image: none;
        border: 1px solid #ccc;
        border-radius: 4px;
    }

    .btnclose {
        margin-right: 2px;
    }

    .formatH2 {
        margin-left: 10px;
        margin-top: -35px;
        font-weight: normal
    }
</style>
<script>

    function InnitDataArchiving(pagesizeNumber) {

        var data = $("#data").val();
        $("#tblProjectArchiving").DataTable({

            ajax: {
                url: './GetClosingData?data=@data',
                type: "Get",
                datatype: 'json',
                contentType: 'application/json',
            },

            "pageLength": pagesizeNumber,
            "bInfo": false,
            "lengthChange": false,
            language: { search: "" },
            "columns": [
                { "data": "ProjectKey", "autoWidth": true, "sClass": "alignLeft" },
                { "data": "ProjectName", "autoWidth": true, "sClass": "alignLeft" },
                { "data": "Manager", "autoWidth": true, "sClass": "alignLeft" },
                { "data": "ProjStatus", "autoWidth": true },
                { "data": "Server", "autoWidth": true, "sClass": "alignLeft" }

            ],
            "rowCallback": function (row, data, index) {
                if (data.statusData == "NoInput") {
                    $(row).css('background-color', '#FFB9B9');
                }
            },
            'columnDefs': [{
                'targets': 5,
                'searchable': false,
                'orderable': false,
                'render': function (data, type, full, meta) {
                    return '<input type="checkbox" class="btnSelect" name="id[]" value="' + $('<div/>').text(data).html() + '">';
                }
            }],
            dataSrc: function (receivedData) {
                if (receivedData == "SessionExpired") {
                    window.location.replace(loginPageUrl);
                }

            },

        });
    }
    function GetModalPopupArchiving(projectKeysList) {

        $.ajax({
        type: "POST",
        url: '@Url.Action("GetClosingValuesData", "ProjectArchiving")',
        data: {
            ProjectIds: projectKeysList
        },

        dataType: "html",
        success: function (response) {
            $('.table-placeholder').html(response);
            $('#type').modal('show');
        },
        error: function (response) {
            alert("error");
        }
    });

  }
    $(document).ready(function () {

        var url = window.location.href;
      //  alert(url);

        var currentMonth = new Date().getMonth() + 1;
        var currentYear = new Date().getFullYear();
         InitTeamCalendar(currentMonth, currentYear);   


        var pagesizeNumber = $("#pageSize").val();

        if (pagesizeNumber == 0) {

            pagesizeNumber = 100;
        }

        $('#projectchoose').change(function () {

            var value = $(this).val();
            jQuery.ajax({
                type: "POST",
                url: './ChangeYourProjectStatus',
                data: { projectChoose: value },
                success: function (result) {

                    //Below is basic code for table redraw, i know it will not work as it will look for no search query
                    var table = $('#tblProjectArchiving').DataTable();
                    table.clear();
                    table.rows.add(result.data).draw();
                }
            });

        });

        InnitDataArchiving(pagesizeNumber);

        var table = $('#tblProjectArchiving').DataTable();
        $('#searchFilter').on('keyup', function () {
            table.search(this.value).draw();
        });

        InitMenu();

        const projectKeysList = [];
        // Handle click on "Select all" control
        $('#chk-select-all').on('click', function () {

            var rows = $("#tblProjectArchiving").DataTable().rows({ 'search': 'applied' }).nodes();
            // Check/uncheck checkboxes for all rows in the table
            $('input[type="checkbox"]', rows).prop('checked', this.checked);

        });

        $("#tblProjectArchiving").on('change', "input[type='checkbox']", function (e) {

            if (!this.checked) {
                var currentRow = $(this).closest("tr");
                var col1 = currentRow.find("td:eq(0)").text();

                for (var i = 0; i < projectKeysList.length; i++) {

                    if (projectKeysList[i] === col1) {

                        projectKeysList.splice(i, 1);
                    }
                }
            }
            else {

                var currentRow = $(this).closest("tr");
                var col1 = currentRow.find("td:eq(0)").text();
                projectKeysList.push(col1);
            }
        });

        $('#frm-example').on('submit', function (e) {
            var form = this;
            e.preventDefault();
            if (projectKeysList.length > 0) {


                GetModalPopupArchiving(projectKeysList);
            }
            else {
                $('#typeMessage').modal('show');
            }
        });

    });

    function InitMenu() {
        $("ul[data-menu-toggle=Management-Console]").removeClass("hide");
        $("a[data-menu-toggle=Management-Console]").addClass("selected-menu");
        $("ul[data-menu-toggle=Projects]").removeClass("hide");
        $("a[data-menu-toggle=Projects]").addClass("selected-menu");
    }

    function InitTeamCalendar(month, year) {
        var teamCalendarDataUrl = $('#GetDataForTeamCalendar').val();
        var loginPageUrl = $("#loginPageUrl").val();
      //  $("#spinner-loading").show();
        $.ajax({
            url: teamCalendarDataUrl,
            type: 'POST',
            data: { month: 12, year: 2022 },
            dataType: "json",
            content: "application/json;charset=utf-8",
            success: function (result) {
                if (result == "SessionExpired") {
                    window.location.replace(loginPageUrl);
                    return;
                }
             
            },
            error: function (result) {
                $("#spinner-loading").hide();
            }
        })
    }

</script>